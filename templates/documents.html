<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Documents ‚Äî AcadRAG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{
      font-family: Inter, Arial;
      background: linear-gradient(135deg,#2E0249,#570A57);
      color:#fff; min-height:100vh;
    }
    .container{ max-width:800px; margin:40px auto; }
    .card{
      background: rgba(255,255,255,0.08);
      padding:24px; border-radius:14px;
    }
    h2{ margin-top:0; }

    button{
      background:#A91079; border:none;
      padding:10px 16px; border-radius:8px;
      color:white; cursor:pointer;
    }

    .doc{
      display:flex; justify-content:space-between;
      align-items:center;
      padding:10px; margin-top:8px;
      background:rgba(0,0,0,0.25);
      border-radius:8px;
    }

    .spinner{
      width:13px; height:13px;
      border-radius:50%;
      border:3px solid rgba(255,255,255,0.3);
      border-top-color:white;
      animation:spin 1s linear infinite;
      display:inline-block;
      margin-left:8px;
    }
    @keyframes spin { to{ transform:rotate(360deg); } }

    a{ color:#fff; text-decoration:none; }

    .upload-btn{
      min-width: 140px;
      height: 40px;      
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    button:disabled{
      opacity: 0.6;
      cursor: not-allowed;
    }

  </style>
</head>
<body>
<div class="container">
  <div class="card">
    <h2>üìÑ Manage Documents</h2>

    <!-- UPLOAD -->
    <form id="uploadForm">
      <input type="file" name="file" accept=".pdf" required>
      <button type="submit" class="upload-btn">
        <span id="uploadText">Upload PDF</span>
        <span id="uploadSpin" style="display:none" class="spinner"></span>
      </button>
    </form>

    <div id="status"></div>
    <hr>

    <h3>Uploaded Documents</h3>
    <div id="docs">Loading‚Ä¶</div>

    <br>
    <a href="/dashboard">‚¨Ö Back to Dashboard</a>
  </div>
</div>

<script>
const docsBox = document.getElementById("docs");
const uploadForm = document.getElementById("uploadForm");
const uploadSpin = document.getElementById("uploadSpin");
const statusBox = document.getElementById("status");

async function loadDocs(){
  docsBox.innerHTML = "Loading‚Ä¶ <span class='spinner'></span>";
  const r = await fetch("/documents/list");
  const docs = await r.json();

  docsBox.innerHTML = "";
  if(docs.length === 0){
    docsBox.innerHTML = "<i>No documents uploaded yet.</i>";
    return;
  }

  docs.forEach(d=>{
    const div = document.createElement("div");
    div.className = "doc";
    div.innerHTML = `
      <span>${d.filename}</span>
      <button onclick="confirmDelete('${d.id}')">Delete</button>
    `;
    docsBox.appendChild(div);
  });
}

async function deleteDoc(id){
  docsBox.innerHTML += " <span class='spinner'></span>";
  await fetch("/documents/delete/" + id, {method:"POST"});
  loadDocs();
}

uploadForm.onsubmit = async (e)=>{
  e.preventDefault();

  const uploadBtn = uploadForm.querySelector("button");
  const uploadText = document.getElementById("uploadText");

  uploadBtn.disabled = true;
  uploadText.textContent = "Uploading‚Ä¶";
  uploadSpin.style.display = "inline-block";
  statusBox.textContent = "";

  const fd = new FormData(uploadForm);
  const r = await fetch("/documents/upload",{method:"POST", body:fd});
  const d = await r.json();

  uploadSpin.style.display = "none";
  uploadText.textContent = "Upload PDF";
  uploadBtn.disabled = false;

  statusBox.textContent = d.success ? "‚úÖ Indexed successfully" : "‚ùå Indexing failed";
  uploadForm.reset();
  loadDocs();
};

function confirmDelete(id){
  if(confirm("Delete this document permanently?")){
    deleteDoc(id);
  }
}

loadDocs();
</script>
</body>
</html>
